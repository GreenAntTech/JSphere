"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};exports.__esModule=!0,exports.createComponent=exports.render=exports.createDocument=exports.createDocumentFromFile=exports.registerComponent=exports.runOnce=exports.runOnLoaded=exports.runAtClient=exports.feature=exports.navigateTo=exports.registerRoute=exports.postMessage=exports.deviceSubscribesTo=exports.subscribeTo=exports.registerAllowedOrigin=void 0,function(){__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return globalThis.URLPattern?[3,2]:[4,Promise.resolve().then((function(){return require("./urlpattern.min.js")}))];case 1:_a.sent(),_a.label=2;case 2:return[2]}}))}))}();var allowedOrigins=[""];function registerAllowedOrigin(uri){allowedOrigins.push(uri)}window.location&&allowedOrigins.push(window.location.origin),exports.registerAllowedOrigin=registerAllowedOrigin;var scriptHost={server:!!globalThis.Deno,client:!globalThis.Deno},registeredMessages={},registeredDeviceMessages={};function subscribeTo(subject,func){subject&&"string"==typeof subject?registeredMessages[subject]=func:console.warn("A subject must be specified when subscribing to a message:",subject)}function deviceSubscribesTo(subject){subject&&"string"==typeof subject?registeredDeviceMessages[subject]=!0:console.warn("A subject must be specified when subscribing to a message:",subject)}function postMessage(subject,data,target){if(void 0===target&&(target=window),void 0===data&&(data={}),"function"!=typeof target.postMessage)throw"target: Must be a window object";target.postMessage("".concat(subject,"::").concat(JSON.stringify(data)))}globalThis.addEventListener("message",(function(event){var thisEvent=event;if(thisEvent.data){var eventData=thisEvent.data,eventOrigin=thisEvent.origin,message=eventData?eventData.split("::"):"",subject=message[0],data=message[1],listenerFound=!1;if(subject)if(allowedOrigins.includes(eventOrigin)){if(registeredDeviceMessages[subject]){listenerFound=!0;var deviceWindow=window;deviceWindow.webkit?deviceWindow.webkit.messageHandlers.Device.postMessage(eventData):deviceWindow.Device.postMessage(eventData)}if(registeredMessages[subject]){listenerFound=!0;var jsonData=data?JSON.parse(data):{};registeredMessages[subject](jsonData)}for(var children,_loop_1=function(childElement){childElement._subscribedTo(subject)&&(listenerFound=!0,setTimeout((function(){var jsonData=data?JSON.parse(data):{};childElement._onMessageReceived(subject,jsonData)}),0))},_i=0,children_1=window.document.querySelectorAll("[data-listening]");_i<children_1.length;_i++){var childElement;_loop_1(children_1[_i])}listenerFound||console.warn("No message listener was found for the subject '".concat(subject,"'"))}else console.warn("Message origin not registered:",eventOrigin);else console.warn("Missing message subject:",message)}else console.warn("An invalid message structure was received:",thisEvent.data)}),!1),exports.subscribeTo=subscribeTo,exports.deviceSubscribesTo=deviceSubscribesTo,exports.postMessage=postMessage;var registeredRoutes={};function registerRoute(path,handler){void 0!==path&&"string"==typeof path?"function"==typeof handler?registeredRoutes[path]=handler:console.warn("A valid hanlder must be specified when registering a route:",handler):console.warn("A path must be specified when registering a route:",path)}function navigateTo(path){if(void 0===path)globalThis.dispatchEvent(new Event("popstate"));else{if(path==window.location.pathname)return;if("string"!=typeof path)return void console.warn("Provided path must of type string:",path);window.history.pushState({},"",path),dispatchEvent(new Event("popstate"))}}exports.registerRoute=registerRoute,globalThis.addEventListener("popstate",(function(){return __awaiter(void 0,void 0,void 0,(function(){var path,_a,_b,_i,routePath,route,pattern,params,searchParams,_c,_d,_e,key,value;return __generator(this,(function(_f){switch(_f.label){case 0:for(_b in path=window.location.href,_a=[],registeredRoutes)_a.push(_b);_i=0,_f.label=1;case 1:if(!(_i<_a.length))return[3,4];if(routePath=_a[_i],route={path:routePath,handler:registeredRoutes[routePath]},!(pattern=new globalThis.URLPattern({pathname:route.path})).test(path))return[3,3];for((params=pattern.exec(path).pathname.groups)[0]&&(params={path:params[0]}),searchParams=new URLSearchParams(window.location.search),_c=0,_d=searchParams.entries();_c<_d.length;_c++)_e=_d[_c],key=_e[0],value=_e[1],params[key]=value;return[4,route.handler(params)];case 2:return _f.sent(),[3,4];case 3:return _i++,[3,1];case 4:return[2]}}))}))}),!1),exports.navigateTo=navigateTo;var Feature=function(){function Feature(flags){this.featureFlags=[],this.featureFlags=flags}return Feature.prototype.flag=function(obj){return __awaiter(this,void 0,void 0,(function(){var prop,found,flags,_i,flags_1,flag;return __generator(this,(function(_a){for(prop in obj){for(found=!1,flags=prop.split(","),_i=0,flags_1=flags;_i<flags_1.length;_i++)if(flag=flags_1[_i],this.featureFlags.includes(flag)||"default"==flag){obj[prop](),found=!0;break}if(found)break}return[2]}))}))},Feature}(),featureFlags=function(){if(scriptHost.client){var featureFlags_1=window.document.cookie.split("; ").find((function(row){return row.startsWith("featureFlags=")}));if(featureFlags_1)return featureFlags_1.split("=")[1].split(":")}return[]}();exports.feature=new Feature(featureFlags);var RenderingStatus=function(){function RenderingStatus(){this.rootElement=null}return Object.defineProperty(RenderingStatus.prototype,"document",{set:function(value){this.rootElement=value},enumerable:!1,configurable:!0}),Object.defineProperty(RenderingStatus.prototype,"atClient",{get:function(){return"client"===this.rootElement.getAttribute("data-rendering-status")},enumerable:!1,configurable:!0}),Object.defineProperty(RenderingStatus.prototype,"atServer",{get:function(){return"server"===this.rootElement.getAttribute("data-rendering-status")},enumerable:!1,configurable:!0}),Object.defineProperty(RenderingStatus.prototype,"loaded",{get:function(){return null===this.rootElement.getAttribute("data-rendering-status")},enumerable:!1,configurable:!0}),RenderingStatus}(),renderingStatus=new RenderingStatus;function runAtClient(fn){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return renderingStatus.atClient||renderingStatus.loaded?[4,fn()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2]}}))}))}function runOnLoaded(fn){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return renderingStatus.loaded?[4,fn()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2]}}))}))}function runOnce(fn){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return renderingStatus.atServer||renderingStatus.loaded?[4,fn()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2]}}))}))}exports.runAtClient=runAtClient,exports.runOnLoaded=runOnLoaded,exports.runOnce=runOnce;var componentFactory={};function registerComponent(type,initFunction){componentFactory[type]=initFunction}function createDocumentFromFile(path,ctx,config){return __awaiter(this,void 0,void 0,(function(){var file,content;return __generator(this,(function(_a){switch(_a.label){case 0:return scriptHost.server?[4,ctx.getPackageItem(path)]:[3,5];case 1:return(file=_a.sent())?[4,createDocument(content=(new TextDecoder).decode(file.content),ctx,config)]:[3,3];case 2:return[2,_a.sent()];case 3:throw"File Not Found";case 4:return[3,6];case 5:return[2,""];case 6:return[2]}}))}))}function createDocument(html,ctx,config){return __awaiter(this,void 0,void 0,(function(){var document_1,appContext,_i,_a,item,_this=this;return __generator(this,(function(_b){switch(_b.label){case 0:return scriptHost.server?(document_1=ctx.parser.parseFromString(html,"text/html"),appContext={_componentTemplates:[],document:document_1,getResource:function(path){return __awaiter(_this,void 0,void 0,(function(){var file,content;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,ctx.getPackageItem(path)];case 1:if(file=_a.sent())return[2,content=(new TextDecoder).decode(file.content)];throw"File Not Found"}}))}))},importModule:function(url){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.resolve().then((function(){return require(url+"?eTag=".concat(ctx.domain.hostname,":").concat(ctx.domain.cacheDTS))}))];case 1:return[2,_a.sent()]}}))}))},loadCaptions:function(url){return __awaiter(_this,void 0,void 0,(function(){var module,captions;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.resolve().then((function(){return require(url+"?eTag=".concat(ctx.domain.hostname,":").concat(ctx.domain.cacheDTS))}))];case 1:return module=_a.sent(),captions=module.captions,[2,function(value){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var caption=captions[value]||value;if(args&&args.length>0)for(var i=0;i<args.length;i++)caption=caption.replaceAll("$"+(i+1),args[i]);return caption}]}}))}))}},document_1.documentElement.setAttribute("data-rendering-status","server"),[4,render(document_1.documentElement,config,appContext)]):[3,2];case 1:for(_b.sent(),_i=0,_a=appContext._componentTemplates;_i<_a.length;_i++)(item=_a[_i]).parent.insertBefore(item.template,item.parent.children[0]);return[2,document_1.documentElement.outerHTML];case 2:return[2,""]}}))}))}function render(element,config,ctx){return __awaiter(this,void 0,void 0,(function(){var children,_i,children_2,childElement,children,_a,children_3,childElement,children,_b,children_4,childElement,_this=this;return __generator(this,(function(_c){switch(_c.label){case 0:if(element?renderingStatus.document=element.ownerDocument.documentElement:(element=window.document.documentElement,renderingStatus.document=element),ctx||(ctx={_componentTemplates:[],document:renderingStatus.document,getResource:function(path){return __awaiter(_this,void 0,void 0,(function(){var response,content;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch(path)];case 1:return 200!==(response=_a.sent()).status?[3,3]:[4,response.text()];case 2:return[2,content=_a.sent()];case 3:throw"File Not Found"}}))}))},importModule:function(url){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.resolve().then((function(){return require(url)}))];case 1:return[2,_a.sent()]}}))}))},loadCaptions:function(url){return __awaiter(_this,void 0,void 0,(function(){var module,captions;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.resolve().then((function(){return require(url)}))];case 1:return module=_a.sent(),captions=module.captions,[2,function(value){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var caption=captions[value]||value;if(args&&args.length>0)for(var i=0;i<args.length;i++)caption=caption.replaceAll("$"+(i+1),args[i]);return caption}]}}))}))}}),createComponent(element,ctx),!renderingStatus.atServer)return[3,6];element.setAttribute("data-id","root"),children=element.querySelectorAll("[data-id]"),_i=0,children_2=children,_c.label=1;case 1:return _i<children_2.length?((childElement=children_2[_i]).setAttribute("data-parent","root"),createComponent(childElement,ctx),childElement._render?[4,childElement._render(config)]:[3,3]):[3,5];case 2:_c.sent(),_c.label=3;case 3:element._components[childElement.getAttribute("data-id")]=childElement,_c.label=4;case 4:return _i++,[3,1];case 5:return element.setAttribute("data-rendering-status","client"),[3,18];case 6:if(!renderingStatus.atClient)return[3,12];children=element.querySelectorAll('[data-parent="root"]'),_a=0,children_3=children,_c.label=7;case 7:return _a<children_3.length?(createComponent(childElement=children_3[_a],ctx),childElement._render?[4,childElement._render(config)]:[3,9]):[3,11];case 8:_c.sent(),_c.label=9;case 9:element._components[childElement.getAttribute("data-id")]=childElement,_c.label=10;case 10:return _a++,[3,7];case 11:return element.removeAttribute("data-rendering-status"),[3,18];case 12:element.setAttribute("data-id","root"),children=element.querySelectorAll("[data-id]"),_b=0,children_4=children,_c.label=13;case 13:return _b<children_4.length?((childElement=children_4[_b]).setAttribute("data-parent","root"),createComponent(childElement,ctx),childElement._render?[4,childElement._render(config)]:[3,15]):[3,17];case 14:_c.sent(),_c.label=15;case 15:element._components[childElement.getAttribute("data-id")]=childElement,_c.label=16;case 16:return _b++,[3,13];case 17:navigateTo(),_c.label=18;case 18:return[2,element._components]}}))}))}function createComponent(element,ctx){var _this=this;if(!element._extend){var _messageListeners={},_childComponents={},_state={},_template=null;Object.defineProperties(element,{_extend:{value:function(obj){var props={},_loop_2=function(prop){"render"==prop?props["_"+prop]={value:function(props){return __awaiter(_this,void 0,void 0,(function(){var propObject,attrs,_i,_a,attr;return __generator(this,(function(_b){switch(_b.label){case 0:if("object"!=typeof props&&(props={}),element._renderAtClient&&scriptHost.server)return[2];for(propObject=obj[prop],attrs={},_i=0,_a=element.attributes;_i<_a.length;_i++)(attr=_a[_i]).name.startsWith("data-is-")&&(attrs[attr.name.substring(8)]=attr.value||!0);return props=Object.assign(attrs,props),[4,propObject(Object.freeze(props))];case 1:return _b.sent(),renderingStatus.atServer&&element.setAttribute("data-is-state",JSON.stringify(_state)),[2]}}))}))}}:"function"==typeof obj[prop]?props["_"+prop]={value:obj[prop]}:props["_"+prop]=obj[prop]};for(var prop in obj)_loop_2(prop);Object.defineProperties(element,props)}},_components:{get:function(){return _childComponents}},_onMessageReceived:{value:function(subject,data){_messageListeners[subject]&&_messageListeners[subject](data)}},_renderAtClient:{get:function(){return"client"===element.getAttribute("data-render-at")}},_subscribedTo:{value:function(subject){return!!_messageListeners[subject]}},_subscribeTo:{value:function(subject,func){_messageListeners[subject]=func,element.setAttribute("data-listening","true")}},_template:{set:function(value){_template=value},get:function(){return _template}},_unsubscribeTo:{value:function(subject){delete _messageListeners[subject],0===Object.keys(_messageListeners).length&&element.removeAttribute("data-listening")}},_useState:{value:function(state,obj){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return renderingStatus.atClient?element.hasAttribute("data-is-state")&&(Object.assign(state,obj),Object.assign(state,JSON.parse(element.getAttribute("data-is-state"))),element.removeAttribute("data-is-state")):(Object.assign(state,obj),_state=state),[2,state]}))}))}},_useTemplate:{value:function(template,func){return renderingStatus.atServer?(template=sanitize(template),_childComponents={},loadTemplate(element,template),parseTemplate(element,ctx)):renderingStatus.atClient?(element._renderAtClient&&(_childComponents={},loadTemplate(element,template)),parseTemplate(element,ctx)):func?setTimeout((function(){template.startsWith("/")&&template===element.getAttribute("data-view-template")||(_childComponents={},loadTemplate(element,template),parseTemplate(element,ctx),func())}),0):(_childComponents={},loadTemplate(element,template),parseTemplate(element,ctx)),element._components}},_useTemplateUrl:{value:function(url,func){return __awaiter(_this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return renderingStatus.atServer?(_childComponents={},[4,loadTemplateUrl(element,ctx,url)]):[3,2];case 1:return _a.sent(),parseTemplate(element,ctx),[3,8];case 2:return renderingStatus.atClient?element._renderAtClient?(_childComponents={},[4,loadTemplateUrl(element,ctx,url)]):[3,4]:[3,5];case 3:_a.sent(),_a.label=4;case 4:return parseTemplate(element,ctx),[3,8];case 5:return func?(setTimeout((function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return url===element.getAttribute("data-view-template")?[2]:(_childComponents={},[4,loadTemplateUrl(element,ctx,url)]);case 1:return _a.sent(),parseTemplate(element,ctx),func(),[2]}}))}))}),0),[3,8]):[3,6];case 6:return url===element.getAttribute("data-view-template")?[2]:(_childComponents={},[4,loadTemplateUrl(element,ctx,url)]);case 7:_a.sent(),parseTemplate(element,ctx),_a.label=8;case 8:return[2,element._components]}}))}))}}});var type=element.getAttribute("data-is");type&&(componentFactory[type]?componentFactory[type](element,ctx):console.warn("The component type '".concat(type,"' is not registered.")))}}function loadTemplate(element,template){template&&(renderingStatus.atClient&&null!==element.getAttribute("data-view-template")||(element.setAttribute("data-view-template","component"),element.innerHTML=template))}function loadTemplateUrl(element,ctx,url){return __awaiter(this,void 0,void 0,(function(){var template;return __generator(this,(function(_a){switch(_a.label){case 0:return url?renderingStatus.atClient&&null!==element.getAttribute("data-view-template")?[2]:(element.setAttribute("data-view-template",url),[4,ctx.getResource(url)]):[2];case 1:return template=_a.sent(),element.innerHTML=template,[2]}}))}))}function parseTemplate(element,ctx){if(renderingStatus.atServer){for(var templates,_i=0,templates_1=templates=element.querySelectorAll("template");_i<templates_1.length;_i++){var template=templates_1[_i];ctx._componentTemplates.push({parent:template.parentElement,template:template}),template.parentElement._template=template.parentElement.removeChild(template)}for(var children,_a=0,children_5=children=element.querySelectorAll("[data-id]");_a<children_5.length;_a++){var childElement;(childElement=children_5[_a]).setAttribute("data-parent",element.getAttribute("data-id")),createComponent(childElement,ctx),element._components[childElement.getAttribute("data-id")]=childElement}}else if(renderingStatus.atClient){for(var templates,_b=0,templates_2=templates=element.querySelectorAll("template");_b<templates_2.length;_b++){var template;(template=templates_2[_b]).parentElement._template=template}if(element._renderAtClient)for(var children,_c=0,children_6=children=element.querySelectorAll("[data-id]");_c<children_6.length;_c++){var childElement;(childElement=children_6[_c]).setAttribute("data-parent",element.getAttribute("data-id")),createComponent(childElement,ctx),element._components[childElement.getAttribute("data-id")]=childElement}else for(var children,_d=0,children_7=children=element.querySelectorAll('[data-parent="'.concat(element.getAttribute("data-id"),'"]'));_d<children_7.length;_d++){var childElement;createComponent(childElement=children_7[_d],ctx),element._components[childElement.getAttribute("data-id")]=childElement}}else{for(var templates,_e=0,templates_3=templates=element.querySelectorAll("template");_e<templates_3.length;_e++){var template;(template=templates_3[_e]).parentElement._template=template}for(var children,_f=0,children_8=children=element.querySelectorAll("[data-id]");_f<children_8.length;_f++){var childElement;createComponent(childElement=children_8[_f],ctx),element._components[childElement.getAttribute("data-id")]=childElement}}}function sanitize(code){var sanitizedCode;return code.replaceAll(/\?eTag=[a-zA-Z0-9:]+[\"]/g,'"').replaceAll(/\?eTag=[a-zA-Z0-9:]+[\']/g,"'")}exports.registerComponent=registerComponent,exports.createDocumentFromFile=createDocumentFromFile,exports.createDocument=createDocument,exports.render=render,globalThis.render=render,exports.createComponent=createComponent,registerComponent("Repeater",(function(element,ctx){element._extend({render:{value:function(props){element._useTemplate(""),element._visible=props.visible||!0}},add:{value:function(id){var clone,children;element._components[id]?children=(clone=element._components[id]).querySelectorAll('[data-parent="'.concat(id,'"]')):((clone=element._template.content.firstElementChild.cloneNode(!0)).setAttribute("data-id",id),clone.setAttribute("data-parent",element.getAttribute("data-id")),element.appendChild(clone),createComponent(clone,ctx),element._components[id]=clone,children=clone.querySelectorAll("[data-id]"));for(var _i=0,children_9=children;_i<children_9.length;_i++){var childElement=children_9[_i];childElement.setAttribute("data-parent",id),createComponent(childElement,ctx),clone._components[childElement.getAttribute("data-id")]=childElement}return clone._components}},removeAll:{value:function(){if(renderingStatus.loaded)for(var item in element.innerHTML="",element._components)delete element._components[item]}},visible:{set:function(value){element.style.display=value?"":"none"},get:function(){return""===element.style.display}}})}));